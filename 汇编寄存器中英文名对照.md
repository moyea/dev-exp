## 汇编寄存器中英文名对照

|   简称   | 全称                | 说明           |
| :------: | ------------------- | -------------- |
| AH&AL=AX | Accumulator         | 累加寄存器     |
| BH&BL=BX | Base                | 基址寄存器     |
| CH&CL=CX | Count               | 计数寄存器     |
| DH&DL=DX | Data                | 数据寄存器     |
|    SP    | Stack Pointer       | 栈堆寄存器     |
|    BP    | Base Pointer        | 机制指针寄存器 |
|    SI    | Source Pointer      | 源变址寄存器   |
|    DI    | Destination Index   | 目的变址寄存器 |
|    IP    | Instruction Pointer | 指令指针寄存器 |
|    CS    | Code Segment        | 代码段寄存器   |
|    DS    | Date Segment        | 数据段寄存器   |
|    SS    | Stack Segment       | 堆栈段寄存器   |
|    ES    | Extra Segment       | 附加段寄存器   |

## 计算机启动流程

1. 通电

2. 读取ROM里面的BIOS，用来检查硬件
3. 硬件检查通过
4. BIOS根据指定的顺序，检查引导设备的第一个扇区(即主引导扇区)，加载在内存地址0x7C00处
5. 主引导记录把操作权交给操作系统

**注：主引导记录就是引导"操作系统"进入内存的一小段程序，大小不超过1个扇区(512字节)。**

### 0x7C00的由来

0x7C00这个地址来自于Intel第一代个人电脑芯片8088，以后的CPU为了保持兼容，一直使用了这个地址。

当时搭配的操作系统是86-DOS。这个操作系统需要的内存最少是32KB。内存地址从0x0000开始编号，32KB的内存就是0x0000~0x7FFF。

8080芯片本身需要占用0x0000~0x03FF，用来保存各种中断处理程序的储存位置。所以，内存只剩下0x4000~0x7FFF可以使用。

**操作系统启动后，主引导记录就没有用处了，为了它所在的内存地址可以被操作系统重新利用，主引导记录就放在了内存地址的尾部。**由于一个扇区是512字节，主引导记录本身也会产生数据，需要另外留出512字节保存。所以，它的预留位置就变成了：

```
// 由于内存地址是闭区间[0x00000,x7FFFF]，所以地址需要加1
0x7FFFF - 512 - 512 + 1 = 0x7C00
```

计算机启动后，32KB内存的使用情况如下：

```
+--------------------- 0x0
| Interrupts vectors
+--------------------- 0x400
| BIOS data area
+--------------------- 0x5??
| OS load area
+--------------------- 0x7C00
| Boot sector
+--------------------- 0x7E00
| Boot data/stack
+--------------------- 0x7FFF
| (not used)
+--------------------- (...)
```

参考文档 

1. http://www.ruanyifeng.com/blog/2015/09/0x7c00.html
2. https://www.glamenv-septzen.net/en/view/6

### 计算机启动详细流程

计算机通电后，CPU初始化：CPU通电后，通过CS、IP两个寄存器知道从0xFFFF0地址读取

第一条指令，这条指令是跳转指令，跳转到BIOS程序段。由于CPU通电后会初始化CS:IP=0xF000:FFF0，并且CPU初始化后处于实模式，也就是16位系统，20位寻址空间，通过将CS左移4位与IP相加得到最终的地址(CP=2<sup>4</sup> * CS + IP)。接下来是BIOS初始化过程：

1. 硬件自检(ROM等);
2. 监测内存(RAM)、显卡等关键部件是否存在，存在的话工作状态正常；
3. 查找并执行显卡等接口卡的BIOS(显卡等拥有自己的BIOS固件)，对设备进行初始化；
4. 执行系统BIOS进行系统监测，也就是监测计算机有哪些即插即用设备(如，硬盘、光驱、U盘等);
5. 更新CMOS中扩展系统配置数据(ESCD)告知有哪些即插即用设备;
6. 按照指定的启动顺序从软盘、硬盘或者光驱等启动操作系统。

BIOS初始化完成后，读取主引导记录(MBR，Master Boot Record)。主引导记录格式：446Byte 启动代码 + 64Byte硬盘分区表 + 2Byte主引导结束标志符(0x55~0xAA)